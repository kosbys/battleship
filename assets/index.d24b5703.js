var y=Object.defineProperty;var m=(i,t,e)=>t in i?y(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var o=(i,t,e)=>(m(i,typeof t!="symbol"?t+"":t,e),e);const g=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const h of n.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function e(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerpolicy&&(n.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?n.credentials="include":r.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=e(r);fetch(r.href,n)}};g();function k(){let i="";const t="poi",e=new Audio("./src/audio/poi.ogg");document.addEventListener("keydown",s=>{i+=s.key,i===t&&e.play(),t.indexOf(i)&&(i=`${s.key}`)})}function d(i,t=0){return Math.floor(Math.random()*(i-t)+t)}function E(i){return Math.floor(Math.random()*i.length)}function L(i){const t=Math.floor(Math.random()*i.length);return i[t]}function C(){return Math.random()<.5}function S(i,t){return t?{x:d(9,0),y:d(9-i,0)}:{x:d(9-i,0),y:d(9,0)}}function p(i,t){return i.x===t.x&&i.y===t.y}const l=class{constructor(){o(this,"grid");o(this,"ships");o(this,"sunk");this.grid=Object.seal(Array(l.GRID_SIZE).fill(0).map(()=>Array(l.GRID_SIZE).fill(l.EMPTY_CELL))),this.ships=[],this.sunk=0}addShipToGrid(t){t.coordinates.forEach(e=>{this.grid[e.y][e.x]=l.SHIP_CELL})}checkOverlap(t){return this.ships.some(e=>e.coordinates.some(s=>t.some(r=>p(s,r))))}addShipRandom(t){this.addShip(t,S(t.length,t.isVertical))}addShip(t,e){return t.setCoordinates(e),this.checkOverlap(t.coordinates)?!1:(this.ships.push(t),this.addShipToGrid(t),!0)}receiveAttack(t){this.grid[t.y][t.x]=l.HIT_CELL;const e=this.ships.find(s=>s.coordinates.find(r=>p(t,r)));e&&(e.hit(),e.isSunk()&&(this.sunk+=1))}allSunk(){return this.ships.every(t=>t.isSunk())}};let a=l;o(a,"GRID_SIZE",10),o(a,"EMPTY_CELL",0),o(a,"SHIP_CELL",1),o(a,"HIT_CELL",2);class T{constructor(t,e=!1){o(this,"length");o(this,"hits");o(this,"isVertical");o(this,"coordinates");this.length=t,this.hits=0,this.isVertical=e,this.coordinates=[]}hit(){this.hits+=1}createCoordinatesVertical(t){return t.y+this.length>9?!1:([...Array(this.length).keys()].forEach(s=>this.coordinates.push({x:t.x,y:t.y+s})),!0)}createCoordinatesHorizontal(t){return t.x+this.length>9?!1:([...Array(this.length).keys()].forEach(s=>this.coordinates.push({x:t.x+s,y:t.y})),!0)}setCoordinates(t){return this.isVertical?this.createCoordinatesVertical(t):this.createCoordinatesHorizontal(t)}isSunk(){return this.hits===this.length}}class f{constructor(t,e=!1){o(this,"name");o(this,"board");o(this,"isTurn");o(this,"coordsHit");o(this,"coordsRemaining");this.name=t,this.board=new a,this.isTurn=e,this.coordsHit=[],this.coordsRemaining=this.fullCoordinates()}setTurn(t){this.isTurn=t}fullCoordinates(){return this.board.grid.map((e,s)=>e.map((r,n)=>({x:n,y:s}))).flat()}changeTurn(t){this.setTurn(!1),t.setTurn(!0)}checkLoss(){return this.board.allSunk()}checkDuplicateHit(t){return this.coordsHit.some(e=>p(e,t))}attack(t,e){return this.isTurn&&!e.checkDuplicateHit(t)?(e.board.receiveAttack(t),e.coordsHit.push(t),e.checkLoss(),this.changeTurn(e),!0):!1}placeShip(t,e){return this.board.addShip(t,e)}attackRandom(t){const[e]=t.coordsRemaining.splice(E(t.coordsRemaining),1),s=t.board.grid[e.y][e.x];return this.attack(e,t),{coords:e,before:s}}placeFleet(){const t=[5,4,3,3,2];for(;this.board.ships.length<5;)this.board.addShipRandom(new T(L(t),C()))}}const c=document.getElementById("message");class u{constructor(){o(this,"players");this.players={}}createPlayer(t){const e=new f(t,!0);this.players.human=e,e.placeFleet(),this.shipGrid("player")}enemyAttack(){if(!this.players.computer.isTurn)return;const t=document.getElementById("player-ships"),e=this.players.computer.attackRandom(this.players.human),s=t==null?void 0:t.querySelector(`[id='${e.coords.y}${e.coords.x}']`);u.paintCell(s,e.before),c&&(c.textContent="ATTACK!"),this.players.human.checkLoss()&&c&&(c.textContent="YOU LOSE!",this.gameEnd())}createEnemyTargets(){const t=document.getElementById("enemy-ships");t==null||t.childNodes.forEach(e=>{e.addEventListener("click",s=>{if(!this.players.human.isTurn)return;const r=s==null?void 0:s.currentTarget,n={y:+r.id[0],x:+r.id[1]},h=this.players.computer.board.grid[n.y][n.x];this.players.human.attack(n,this.players.computer),u.paintCell(r,h),c&&(c.textContent="ENEMY TURN",setTimeout(()=>{this.enemyAttack()},650)),this.players.computer.checkLoss()&&c&&(c.textContent="YOU WIN!",this.gameEnd())})})}createPlayerAI(){const t=new f("enemy");t.placeFleet(),this.shipGrid("enemy"),this.createEnemyTargets(),this.players.computer=t}shipGrid(t){const e=document.getElementById(`${t}-ships`);[...Array(10).keys()].forEach(s=>{[...Array(10).keys()].forEach(r=>{const n=document.createElement("div");n.id=`${s}${r}`,n.className="w-8 bg-white cell outline outline-2 dark:outline-white outline-black dark:bg-black aspect-square md:w-10 lg:w-12 xl:w-14 2xl:w-18",t==="enemy"&&(n.classList.add("hover:bg-gray-900"),n.classList.add("dark:hover:bg-slate-100")),t==="player"&&this.players.human.board.grid[s][r]===a.SHIP_CELL&&(n.style.backgroundColor="#8d99ae"),e==null||e.append(n)})})}beginGame(){this.createPlayer("player"),this.createPlayerAI()}static paintCell(t,e){e===a.EMPTY_CELL&&(t.style.backgroundColor="#99d98c"),e===a.SHIP_CELL&&(t.style.backgroundColor="#d90429")}gameEnd(){this.players.human.isTurn=!1,this.players.computer.isTurn=!1}}k();const x=new u;x.beginGame();
